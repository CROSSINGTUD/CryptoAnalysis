name: Documentation Deployment
description: Deploy the documentation to GitHub pages when modified

on:
  push:
    branches:
      - master
      - develop
    paths:
      - mkdocs.yml
      - docs/**
      - .github/workflows/gh-pages.yml

concurrency:
  group: gh-pages

permissions:
  pages: write
  deployments: write
  contents: write

jobs:
  deploy-doc:
    name: Deploy Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      - name: Install Dependencies
        run: pip install mike mkdocs-material mkdocs-tooltips git+https://github.com/RedisLabs/mkdocs-include.git git+https://github.com/swissiety/LspLexer4Pygments.git

      - name: Deploy to GitHub Pages
        if: github.event_name == 'push' && github.base_ref == 'develop'
        run: mike deploy develop --push --update-aliases develop latest

      - name: Deploy Doc Version for New Release
        if: github.event_name == 'push' && github.base_ref == 'master'
        run: mike deploy "$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout | sed "s/[^a-zA-Z0-9._-]/_/g" )" --push
